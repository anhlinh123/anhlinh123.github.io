<!DOCTYPE html>
<html>
<head>
  <title>PushNotification</title>
</head>
<body>
    <script>
        function updateButton(button, permission) {
            if (window.Notification.permission == 'granted') {
                button.innerText = 'Subscribed'
                button.disabled = true
            }
            if (window.Notification.permission == 'denied') {
                button.innerText = 'Unsubscribed'
                button.disabled = true
            }
        }

        function subscribeUserToPush() {
          return navigator.serviceWorker
            .register('/service-worker.js')
            .then(function (registration) {
              const subscribeOptions = {
                userVisibleOnly: true,
                applicationServerKey: urlBase64ToUint8Array(
                  'BIA7A6M5KRcpwI-M9CrYFrpmVameyihIjywOIUgmdA3p7NATE2SjIQ1UB-3qLgKvE3CHgsTIlgBX_7nnr5WO-3E',
                ),
              };

              return registration.pushManager.subscribe(subscribeOptions);
            })
            .then(function (pushSubscription) {
              alert(
                'Received PushSubscription: ',
                JSON.stringify(pushSubscription),
              );
              return pushSubscription;
            });
        }

        const button = document.createElement('button')
        button.innerText = 'Subscribe'
        button.onclick = function() {
            Notification.requestPermission()
                .then(function (result) {
                    updateButton(button, result)
                    return result
                })
                .then(function (result) {
                    if (result == 'granted') { 
                        subscribeUserToPush()
                    }
                })
        }
        if (!'Notification' in window) {
            button.innerText = 'Unsupported browser'
        }
        else {
            updateButton(button, window.Notification.permission)
        }

        document.body.appendChild(button)
    </script>
</body>
</html>
